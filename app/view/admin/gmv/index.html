
<div class="row">
    <div class="col-sm-12">
        <div id="main" style="width: 1000px;height:600px;"></div>
    </div>

</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">

                <form method='get' action="__SELF__" class="form-inline">
                      <div class="form-group"  style="margin-right:15px; margin-bottom: 5px;">
    <label for="id" style="margin-right:5px;"> id</label>
    
       <input  class="form-control" name="id" type="text" id="id" size="10" value="{$vo[id] ? $vo[id] : $_GET[id]}" />
       </div>
   

  <div class="form-group"  style="margin-right:15px; margin-bottom: 5px;">
    <label for="date" style="margin-right:5px;"> 时间</label>
    
       <input  class="form-control" name="date" type="text" id="date" size="30" value="{$vo[date] ? $vo[date] : $_GET[date]}" />
       </div>
   

  <div class="form-group"  style="margin-right:15px; margin-bottom: 5px;">
    <label for="category" style="margin-right:5px;"> 类目</label>
    
       <input  class="form-control" name="category" type="text" id="category" size="30" value="{$vo[category] ? $vo[category] : $_GET[category]}" />
       </div>
   

  <div class="form-group"  style="margin-right:15px; margin-bottom: 5px;">
    <label for="gross" style="margin-right:5px;"> 销售额</label>
    
       <input  class="form-control" name="gross" type="text" id="gross" size="30" value="{$vo[gross] ? $vo[gross] : $_GET[gross]}" />
       </div>
   

  <div class="form-group"  style="margin-right:15px; margin-bottom: 5px;">
    <label for="volume" style="margin-right:5px;"> 销量</label>
    
       <input  class="form-control" name="volume" type="text" id="volume" size="30" value="{$vo[volume] ? $vo[volume] : $_GET[volume]}" />
       </div>
   

  <div class="form-group"  style="margin-right:15px; margin-bottom: 5px;">
    <label for="average_price" style="margin-right:5px;"> 宝贝均价</label>
    
       <input  class="form-control" name="average_price" type="text" id="average_price" size="30" value="{$vo[average_price] ? $vo[average_price] : $_GET[average_price]}" />
       </div>
   

  <div class="form-group"  style="margin-right:15px; margin-bottom: 5px;">
    <label for="market_share" style="margin-right:5px;"> 市场份额</label>
    
       <input  class="form-control" name="market_share" type="text" id="market_share" size="30" value="{$vo[market_share] ? $vo[market_share] : $_GET[market_share]}" />
       </div>
   

  <div class="form-group"  style="margin-right:15px; margin-bottom: 5px;">
    <label for="number" style="margin-right:5px;"> 宝贝数</label>
    
       <input  class="form-control" name="number" type="text" id="number" size="30" value="{$vo[number] ? $vo[number] : $_GET[number]}" />
       </div>
   

  <div class="form-group"  style="margin-right:15px; margin-bottom: 5px;">
    <label for="store_number" style="margin-right:5px;"> store_number</label>
    
       <input  class="form-control" name="store_number" type="text" id="store_number" size="30" value="{$vo[store_number] ? $vo[store_number] : $_GET[store_number]}" />
       </div>
   

  <div class="form-group"  style="margin-right:15px; margin-bottom: 5px;">
    <label for="ration" style="margin-right:5px;"> 销售额同比</label>
    
       <input  class="form-control" name="ration" type="text" id="ration" size="30" value="{$vo[ration] ? $vo[ration] : $_GET[ration]}" />
       </div>
   

  <div class="form-group"  style="margin-right:15px; margin-bottom: 5px;">
    <label for="chain_ratio" style="margin-right:5px;"> 销售额环比</label>
    
       <input  class="form-control" name="chain_ratio" type="text" id="chain_ratio" size="30" value="{$vo[chain_ratio] ? $vo[chain_ratio] : $_GET[chain_ratio]}" />
       </div>
   


                    <button type="submit" class="btn btn-primary">搜索</button>
                </form>
                <br/>
                <php> $query = strstr($_SERVER["REQUEST_URI"],'?');</php>

                <div class="row">
                    <php>if(0==1){</php>
                    <div class="col-lg-1"><a href="__CONTROLLER__/add" class="btn btn-block btn-info btn-sm ">添加</a>
                    </div>
                    <php>}</php>


                    <php>if(1==1){</php>
                    <div class="col-lg-1"><a href="__CONTROLLER__/exportExcel<?=$query?>"
                                             class="btn btn-block btn-info btn-sm ">导出</a></div>
                    <php>}</php>
                </div>


            </div>

            <!-- show="id:编号|8%,title:名称:edit,create_time|toDate='y-m-d':创建时间,status|getStatus2:状态,{$fields}"-->
            <div class="card-body">
                <html:list id="checkList" name="vo"
                           style="table table-bordered table-hover dataTable dtr-inline"
                           checkbox="true" action="true" datasource="list" show="id:id::sort,date:时间::sort,category:类目::sort,gross:销售额::sort,volume:销量::sort,average_price:宝贝均价::sort,market_share:市场份额::sort,number:宝贝数::sort,store_number:store_number::sort,ration:销售额同比::sort,chain_ratio:销售额环比::sort" actionlist="edit:查看:id"/>



            </div>

            <div class="card-body">
            <div class="row">
                <php>if(0==1){</php>
                <a href="javascript:;" onclick="del();" class="btn btn-info"> 批量禁用</a>
                <php>}</php>

                <php>if(0==1){</php>
                <a href="javascript:;" onclick="foreverdel();" class="btn btn-danger"> 批量删除</a>
                <php>}</php>
            </div>
            <div class="container text-center">
                {$page}
                <div style="margin-top:10px;">跳转到<input type="text" style="width: 100px;" id="txt_page"
                                                        name="txt_page">页
                    <input id="btn_jump" type="button" value="跳转"></div>
            </div>
            </div>

        </div>

    </div>
</div>





<script src="__PUBLIC__/common/Gmv.js"></script>

<script>
    <php>
        $params = input('get.');
        unset($params['p']);
        $params = http_build_query($params);
    </php>

        $(function () {
            console.log(URL);

            $('#btn_jump').click(function () {
                goPage();
            });
            function goPage() {
                var params = '{$params}';
                var url = CONTROLLER+"/index?"+params;
                url += "&p="+$('#txt_page').val();
                window.location.href = url;

            }
        });






</script>

<?php
    $arr = $list->toArray()['data'];
    $category = array_column($arr,'category');
    $category = json_encode($category,JSON_UNESCAPED_UNICODE);

    $selected = [];
    for($i = 0; $i<10; $i++){
        $temp = [];
        $selected[$arr[$i]['category']] = true;
    }
    $selected = json_encode($selected,JSON_UNESCAPED_UNICODE);

    $seriesData = [];
    foreach($arr as $k=>$v){
        $temp = [];
        $temp['value'] = $v['gross'];
        $temp['name'] = $v['category'];
        $seriesData[] = $temp;
    }
    $seriesData = json_encode($seriesData,JSON_UNESCAPED_UNICODE);
?>

<script>

 var myChart = echarts.init(document.getElementById('main'));
    let category = {$category};
    let selected = {$selected};
    let seriesData = {$seriesData};

    var data = genData(50);
    console.log(data);



option = {
    title: {
        text: '同名数量统计',
        subtext: '纯属虚构',
        left: 'center'
    },
    tooltip: {
        trigger: 'item',
        formatter: '{a} <br/>{b} : {c} ({d}%)'
    },
    legend: {
        type: 'scroll',
        orient: 'vertical',
        right: 10,
        top: 20,
        bottom: 20,
        data: category,

        selected: selected
    },
    series: [
        {
            name: '姓名',
            type: 'pie',
            radius: '55%',
            center: ['40%', '50%'],
            data: seriesData,
            emphasis: {
                itemStyle: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        }
    ]
};




function genData(count) {
    var nameList = [
        '赵', '钱', '孙', '李', '周', '吴', '郑', '王', '冯', '陈', '褚', '卫', '蒋', '沈', '韩', '杨', '朱', '秦', '尤', '许', '何', '吕', '施', '张', '孔', '曹', '严', '华', '金', '魏', '陶', '姜', '戚', '谢', '邹', '喻', '柏', '水', '窦', '章', '云', '苏', '潘', '葛', '奚', '范', '彭', '郎', '鲁', '韦', '昌', '马', '苗', '凤', '花', '方', '俞', '任', '袁', '柳', '酆', '鲍', '史', '唐', '费', '廉', '岑', '薛', '雷', '贺', '倪', '汤', '滕', '殷', '罗', '毕', '郝', '邬', '安', '常', '乐', '于', '时', '傅', '皮', '卞', '齐', '康', '伍', '余', '元', '卜', '顾', '孟', '平', '黄', '和', '穆', '萧', '尹', '姚', '邵', '湛', '汪', '祁', '毛', '禹', '狄', '米', '贝', '明', '臧', '计', '伏', '成', '戴', '谈', '宋', '茅', '庞', '熊', '纪', '舒', '屈', '项', '祝', '董', '梁', '杜', '阮', '蓝', '闵', '席', '季', '麻', '强', '贾', '路', '娄', '危'
    ];
    var legendData = [];
    var seriesData = [];
    var selected = {};
    for (var i = 0; i < count; i++) {
        name = Math.random() > 0.65
            ? makeWord(4, 1) + '·' + makeWord(3, 0)
            : makeWord(2, 1);
        legendData.push(name);
        seriesData.push({
            name: name,
            value: Math.round(Math.random() * 100000)
        });
        selected[name] = i < 6;
    }

    return {
        legendData: legendData,
        seriesData: seriesData,
        selected: selected
    };

    function makeWord(max, min) {
        var nameLen = Math.ceil(Math.random() * max + min);
        var name = [];
        for (var i = 0; i < nameLen; i++) {
            name.push(nameList[Math.round(Math.random() * nameList.length - 1)]);
        }
        return name.join('');
    }
}



    myChart.setOption(option);
</script>

